@model IEnumerable<PeluqueriaSaaS.Application.DTOs.ServicioDto>

@{
    ViewData["Title"] = "Gestión de Servicios";
}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4 page-header">
        <div>
            <h2><i class="fas fa-concierge-bell text-primary"></i> Gestión de Servicios</h2>
            <p class="text-muted mb-0">Administra los servicios de tu peluquería</p>
        </div>
        <div>
            <a href="/Servicios/Create" class="btn btn-success">
                <i class="fas fa-plus"></i> Nuevo Servicio
            </a>
        </div>
    </div>

    <!-- Filtros de Búsqueda -->
    <div class="card mb-4">
        <div class="card-header">
            <h6 class="card-title mb-0">
                <i class="fas fa-filter text-primary"></i> Filtros de Búsqueda
                @if (ViewBag.TieneFiltros)
                {
                    <span class="badge badge-info ml-2">Filtros activos</span>
                }
            </h6>
        </div>
        <div class="card-body">
            <form id="filtros-form" method="get" action="/Servicios">
                <div class="row">
                    <!-- Filtro Nombre -->
                    <div class="col-md-3 mb-3">
                        <label for="nombre" class="form-label">
                            <i class="fas fa-search text-muted"></i> Buscar por nombre
                        </label>
                        <input type="text" 
                               class="form-control" 
                               id="nombre" 
                               name="nombre" 
                               value="@ViewBag.FiltroNombre" 
                               placeholder="Nombre o descripción..."
                               autocomplete="off">
                    </div>

                    <!-- Filtro Tipo Servicio -->
                    <div class="col-md-3 mb-3">
                        <label for="tipoServicioId" class="form-label">
                            <i class="fas fa-tags text-muted"></i> Tipo de Servicio
                        </label>
                        <select class="form-control" id="tipoServicioId" name="tipoServicioId">
                            @if (ViewBag.TiposServicio != null)
                            {
                                @foreach (var tipo in (List<SelectListItem>)ViewBag.TiposServicio)
                                {
                                    if (tipo.Selected)
                                    {
                                        <option value="@tipo.Value" selected>@tipo.Text</option>
                                    }
                                    else
                                    {
                                        <option value="@tipo.Value">@tipo.Text</option>
                                    }
                                }
                            }
                        </select>
                    </div>

                    <!-- Filtro Precio Mínimo -->
                    <div class="col-md-2 mb-3">
                        <label for="precioMin" class="form-label">
                            <i class="fas fa-dollar-sign text-muted"></i> Precio Min.
                        </label>
                        <input type="number" 
                               class="form-control" 
                               id="precioMin" 
                               name="precioMin" 
                               value="@ViewBag.FiltroPrecioMin" 
                               placeholder="0"
                               min="0"
                               step="0.01">
                    </div>

                    <!-- Filtro Precio Máximo -->
                    <div class="col-md-2 mb-3">
                        <label for="precioMax" class="form-label">
                            <i class="fas fa-dollar-sign text-muted"></i> Precio Max.
                        </label>
                        <input type="number" 
                               class="form-control" 
                               id="precioMax" 
                               name="precioMax" 
                               value="@ViewBag.FiltroPrecioMax" 
                               placeholder="999999"
                               min="0"
                               step="0.01">
                    </div>

                    <!-- Filtro Solo Activos -->
                    <div class="col-md-2 mb-3">
                        <label class="form-label d-block">
                            <i class="fas fa-check-circle text-muted"></i> Estado
                        </label>
                        <div class="form-check">
                            @if (ViewBag.FiltroSoloActivos != null && (bool)ViewBag.FiltroSoloActivos)
                            {
                                <input type="checkbox" 
                                       class="form-check-input" 
                                       id="soloActivos" 
                                       name="soloActivos" 
                                       value="true"
                                       checked>
                            }
                            else
                            {
                                <input type="checkbox" 
                                       class="form-check-input" 
                                       id="soloActivos" 
                                       name="soloActivos" 
                                       value="true">
                            }
                            <label class="form-check-label" for="soloActivos">
                                Solo Activos
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Botones de Acción -->
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                                <button type="button" id="clear-filters-btn" class="btn btn-outline-secondary ml-2">
                                    <i class="fas fa-times"></i> Limpiar
                                </button>
                            </div>
                            <div class="text-muted">
                                <small>
                                    <i class="fas fa-info-circle"></i>
                                    Mostrando @ViewBag.TotalServicios resultado(s)
                                    (@ViewBag.ServiciosActivos activos, @ViewBag.ServiciosInactivos inactivos)
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Acciones de Tabla -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <button type="button" id="stats-button" class="btn btn-info">
                <i class="fas fa-chart-bar"></i> Estadísticas
            </button>
        </div>
        <div class="text-muted">
            @if (ViewBag.TieneFiltros)
            {
                <i class="fas fa-filter text-primary"></i>
                <small>Filtros aplicados - <a href="/Servicios" class="text-primary">Ver todos</a></small>
            }
        </div>
    </div>

    <!-- Tabla de Servicios -->
    <div class="table-responsive">
        <table class="table table-hover">
            <thead class="thead-light">
                <tr>
                    <th><i class="fas fa-tag"></i> Nombre</th>
                    <th><i class="fas fa-align-left"></i> Descripción</th>
                    <th><i class="fas fa-dollar-sign"></i> Precio</th>
                    <th><i class="fas fa-clock"></i> Duración</th>
                    <th><i class="fas fa-tags"></i> Tipo</th>
                    <th><i class="fas fa-toggle-on"></i> Estado</th>
                    <th><i class="fas fa-cogs"></i> Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var servicio in Model)
                {
                    <tr id="servicio-@servicio.Id" class="@(!servicio.EsActivo ? "table-secondary" : "")">
                        <td>
                            <strong>@servicio.Nombre</strong>
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(servicio.Descripcion))
                            {
                                <small class="text-muted">@servicio.Descripcion</small>
                            }
                            else
                            {
                                <small class="text-muted font-italic">Sin descripción</small>
                            }
                        </td>
                        <td class="precio-cell">
                            <strong class="text-success">@servicio.PrecioFormateado</strong>
                        </td>
                        <td>
                            <span class="badge badge-light">@servicio.DuracionFormateada</span>
                        </td>
                        <td class="tipo-servicio-cell">
                            <span class="badge badge-info">@servicio.TipoServicioNombre</span>
                        </td>
                        <td>
                            <span class="badge badge-pill @servicio.EstadoCssClass estado-badge">
                                @servicio.EstadoTexto
                            </span>
                        </td>
                        <td>
                            <div class="btn-group" role="group">
                                <!-- Botón Ver -->
                                <a href="/Servicios/Details/@servicio.Id" 
                                   class="btn btn-sm btn-outline-info" 
                                   title="Ver detalles">
                                    <i class="fas fa-eye"></i>
                                </a>
                                
                                <!-- Botón Editar -->
                                <a href="/Servicios/Edit/@servicio.Id" 
                                   class="btn btn-sm btn-outline-primary" 
                                   title="Editar">
                                    <i class="fas fa-edit"></i>
                                </a>
                                
                                <!-- Botón Cambiar Estado AJAX -->
                                <button type="button" 
                                        class="btn btn-sm @(servicio.EsActivo ? "btn-warning" : "btn-success") toggle-estado-btn"
                                        data-servicio-id="@servicio.Id"
                                        data-estado-actual="@servicio.EsActivo.ToString().ToLower()"
                                        title="@(servicio.EsActivo ? "Desactivar" : "Activar") servicio">
                                    <i class="fas @(servicio.EsActivo ? "fa-ban" : "fa-check")"></i>
                                    @(servicio.EsActivo ? "Desactivar" : "Activar")
                                </button>
                                
                                <!-- Botón Eliminar -->
                                <a href="/Servicios/Delete/@servicio.Id" 
                                   class="btn btn-sm btn-outline-danger" 
                                   title="Eliminar"
                                   onclick="return confirm('¿Está seguro de que desea eliminar este servicio?')">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No se encontraron servicios</h5>
            @if (ViewBag.TieneFiltros)
            {
                <p class="text-muted">Intenta ajustar los filtros de búsqueda</p>
                <a href="/Servicios" class="btn btn-outline-primary">
                    <i class="fas fa-times"></i> Limpiar Filtros
                </a>
            }
            else
            {
                <p class="text-muted">Comienza creando tu primer servicio</p>
                <a href="/Servicios/Create" class="btn btn-success">
                    <i class="fas fa-plus"></i> Crear Primer Servicio
                </a>
            }
        </div>
    }
</div>

<!-- Modal Estadísticas -->
<div class="modal fade" id="statisticsModal" tabindex="-1" role="dialog" aria-labelledby="statisticsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="statisticsModalLabel">
                    <i class="fas fa-chart-bar text-primary"></i> Estadísticas de Servicios
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Contenido será llenado por JavaScript -->
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
                    <p class="mt-2">Calculando estadísticas...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- Token Antiforgery para AJAX -->
@Html.AntiForgeryToken()

@section Scripts {
    <script src="~/js/servicios-index.js"></script>
}