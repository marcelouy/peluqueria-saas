@*
    Archivo: src/PeluqueriaSaaS.Web/Views/Servicios/Delete.cshtml
    PropÃ³sito: ConfirmaciÃ³n de eliminaciÃ³n de servicio - DISEÃ‘O HERMOSO Y SEGURO
    Fecha: Julio 2025
*@

@model PeluqueriaSaaS.Application.DTOs.ServicioDto
@{
    ViewData["Title"] = $"Eliminar - {Model.Nombre}";
}

<!-- Header de la pÃ¡gina con alerta -->
<div class="page-header" style="background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);">
    <div class="container">
        <h1 class="page-title text-danger">
            <i class="fas fa-exclamation-triangle me-3"></i>
            Confirmar EliminaciÃ³n
        </h1>
        <p class="page-subtitle text-danger">
            <strong>Â¡ATENCIÃ“N!</strong> EstÃ¡s a punto de eliminar permanentemente el servicio "<strong>@Model.Nombre</strong>"
        </p>
    </div>
</div>

<div class="container">
    <!-- NavegaciÃ³n breadcrumb -->
    <nav aria-label="breadcrumb" class="fade-in">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index")" class="text-decoration-none">
                    <i class="fas fa-scissors me-1"></i>
                    Servicios
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="@Url.Action("Details", new { id = Model.Id })" class="text-decoration-none">
                    <i class="fas fa-info-circle me-1"></i>
                    @Model.Nombre
                </a>
            </li>
            <li class="breadcrumb-item active text-danger">
                <i class="fas fa-trash me-1"></i>
                Eliminar
            </li>
        </ol>
    </nav>

    <!-- Alerta principal de advertencia -->
    <div class="alert alert-danger fade-in" style="border-left: 5px solid #dc3545;">
        <div class="d-flex align-items-center">
            <div class="me-3">
                <i class="fas fa-exclamation-triangle fa-2x text-danger"></i>
            </div>
            <div class="flex-grow-1">
                <h5 class="alert-heading mb-2">
                    <i class="fas fa-warning me-2"></i>
                    Â¡Esta acciÃ³n es irreversible!
                </h5>
                <p class="mb-2">
                    Una vez eliminado, no podrÃ¡s recuperar este servicio ni su informaciÃ³n asociada.
                </p>
                <hr>
                <p class="mb-0">
                    <strong>RecomendaciÃ³n:</strong> Si no deseas usar mÃ¡s este servicio, considera 
                    <a href="@Url.Action("Edit", new { id = Model.Id })" class="alert-link">desactivarlo</a> 
                    en lugar de eliminarlo.
                </p>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- InformaciÃ³n del servicio a eliminar -->
        <div class="col-lg-8">
            <!-- Vista previa del servicio -->
            <div class="card fade-in" style="border-left: 5px solid #dc3545;">
                <div class="card-header bg-light">
                    <h5 class="mb-0 text-danger">
                        <i class="fas fa-info-circle me-2"></i>
                        Servicio que se eliminarÃ¡
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Recrear el service-card pero con estilo de "eliminaciÃ³n" -->
                    <div class="service-card" style="filter: grayscale(20%); opacity: 0.9;">
                        <div class="service-header">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h3 class="service-title mb-2">
                                        <i class="fas fa-scissors me-2"></i>
                                        @Model.Nombre
                                    </h3>
                                    <div class="service-category">
                                        <i class="fas fa-tag me-2"></i>
                                        @Model.TipoServicioNombre
                                    </div>
                                </div>
                                <div class="text-end">
                                    <span class="badge @Model.EstadoCssClass fs-6">
                                        <i class="fas fa-@(Model.EsActivo ? "check-circle" : "pause-circle") me-1"></i>
                                        @Model.EstadoTexto
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="service-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="service-price">
                                        <i class="fas fa-dollar-sign me-2"></i>
                                        @Model.PrecioFormateado
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="service-duration">
                                        <i class="fas fa-clock me-2"></i>
                                        @Model.DuracionFormateada
                                    </div>
                                </div>
                            </div>
                            
                            @if (!string.IsNullOrWhiteSpace(Model.Descripcion))
                            {
                                <div class="service-description mt-4">
                                    <h6><i class="fas fa-align-left me-2"></i>DescripciÃ³n</h6>
                                    <p class="mb-0">@Model.Descripcion</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- InformaciÃ³n detallada -->
            <div class="card mt-4 fade-in">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-database me-2"></i>
                        InformaciÃ³n que se perderÃ¡
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-circle text-danger me-2" style="font-size: 0.5em;"></i>
                                    <strong>Nombre:</strong> @Model.Nombre
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-circle text-danger me-2" style="font-size: 0.5em;"></i>
                                    <strong>Precio:</strong> @Model.PrecioFormateado
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-circle text-danger me-2" style="font-size: 0.5em;"></i>
                                    <strong>DuraciÃ³n:</strong> @Model.DuracionFormateada
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-circle text-danger me-2" style="font-size: 0.5em;"></i>
                                    <strong>Tipo:</strong> @Model.TipoServicioNombre
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-circle text-danger me-2" style="font-size: 0.5em;"></i>
                                    <strong>Estado:</strong> @Model.EstadoTexto
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-circle text-danger me-2" style="font-size: 0.5em;"></i>
                                    <strong>Fecha creaciÃ³n:</strong> @Model.FechaCreacion.ToString("dd/MM/yyyy")
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-circle text-danger me-2" style="font-size: 0.5em;"></i>
                                    <strong>ID del servicio:</strong> <code>@Model.Id</code>
                                </li>
                                @if (!string.IsNullOrWhiteSpace(Model.Descripcion))
                                {
                                    <li class="mb-2">
                                        <i class="fas fa-circle text-danger me-2" style="font-size: 0.5em;"></i>
                                        <strong>DescripciÃ³n personalizada</strong>
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar con opciones -->
        <div class="col-lg-4">
            <!-- Acciones principales -->
            <div class="card fade-in">
                <div class="card-header bg-danger text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        Confirmar AcciÃ³n
                    </h6>
                </div>
                <div class="card-body">
                    @using (Html.BeginForm("Delete", "Servicios", FormMethod.Post, new { @class = "deletion-form" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(m => m.Id)

                        <!-- Checkbox de confirmaciÃ³n -->
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="confirmarEliminacion" required>
                            <label class="form-check-label text-danger fw-bold" for="confirmarEliminacion">
                                Entiendo que esta acciÃ³n es irreversible
                            </label>
                        </div>

                        <!-- Campo de confirmaciÃ³n por nombre -->
                        <div class="form-group mb-4">
                            <label class="form-label text-danger fw-bold">
                                Para confirmar, escribe el nombre del servicio:
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="confirmacionNombre" 
                                   placeholder="@Model.Nombre"
                                   autocomplete="off"
                                   required>
                            <small class="form-text text-muted">
                                Escribe exactamente: <strong>@Model.Nombre</strong>
                            </small>
                        </div>

                        <div class="d-grid gap-2">
                            <!-- BotÃ³n Eliminar - ROJO HERMOSO pero DESHABILITADO hasta confirmar -->
                            <button type="submit" 
                                    class="btn btn-delete btn-icon" 
                                    id="btnEliminar" 
                                    disabled>
                                <i class="fas fa-trash"></i>
                                Eliminar Permanentemente
                            </button>
                        </div>
                    }
                </div>
            </div>

            <!-- Alternativas -->
            <div class="card mt-4 fade-in">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>
                        Alternativas Recomendadas
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <!-- BotÃ³n Desactivar - AMARILLO -->
                        @if (Model.EsActivo)
                        {
                            <button type="button" 
                                    class="btn btn-warning btn-icon" 
                                    onclick="desactivarServicio()">
                                <i class="fas fa-pause"></i>
                                Desactivar (Recomendado)
                            </button>
                        }

                        <!-- BotÃ³n Editar - NARANJA -->
                        <a href="@Url.Action("Edit", new { id = Model.Id })" 
                           class="btn btn-edit btn-icon">
                            <i class="fas fa-edit"></i>
                            Editar Servicio
                        </a>

                        <!-- BotÃ³n Duplicar antes de eliminar -->
                        <button type="button" 
                                class="btn btn-info btn-icon" 
                                onclick="duplicarAntes()">
                            <i class="fas fa-copy"></i>
                            Duplicar Primero
                        </button>
                    </div>
                </div>
            </div>

            <!-- NavegaciÃ³n -->
            <div class="card mt-4 fade-in">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-navigation me-2"></i>
                        NavegaciÃ³n
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <!-- BotÃ³n Ver Detalles - AZUL -->
                        <a href="@Url.Action("Details", new { id = Model.Id })" 
                           class="btn btn-view btn-icon">
                            <i class="fas fa-eye"></i>
                            Ver Detalles
                        </a>

                        <!-- BotÃ³n Volver a Lista - GRIS -->
                        <a href="@Url.Action("Index")" 
                           class="btn btn-secondary btn-icon">
                            <i class="fas fa-arrow-left"></i>
                            Volver a Lista
                        </a>

                        <!-- BotÃ³n Cancelar - GRIS -->
                        <button type="button" 
                                class="btn btn-secondary btn-icon" 
                                onclick="cancelarEliminacion()">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>

            <!-- EstadÃ­sticas de impacto -->
            <div class="card mt-4 fade-in">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        Impacto de la EliminaciÃ³n
                    </h6>
                </div>
                <div class="card-body text-center">
                    <div class="row">
                        <div class="col-6 mb-3">
                            <div class="border rounded p-2">
                                <h6 class="text-danger mb-1">0</h6>
                                <small class="text-muted">Citas pendientes</small>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="border rounded p-2">
                                <h6 class="text-warning mb-1">15</h6>
                                <small class="text-muted">Veces usado</small>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="border rounded p-2">
                                <h6 class="text-info mb-1">@Model.PrecioFormateado</h6>
                                <small class="text-muted">Ingresos histÃ³ricos</small>
                            </div>
                        </div>
                    </div>
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        Esta informaciÃ³n se perderÃ¡
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Formulario oculto para desactivar -->
<form id="desactivarForm" method="post" style="display: none;">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script>
        // Variables para validaciÃ³n
        const nombreServicio = '@Html.Raw(Json.Serialize(Model.Nombre))';
        const btnEliminar = document.getElementById('btnEliminar');
        const checkboxConfirmar = document.getElementById('confirmarEliminacion');
        const inputNombre = document.getElementById('confirmacionNombre');

        // FunciÃ³n para validar y habilitar botÃ³n
        function validarFormulario() {
            const nombreCorrecto = inputNombre.value.trim() === nombreServicio;
            const checkboxMarcado = checkboxConfirmar.checked;
            
            const puedeEliminar = nombreCorrecto && checkboxMarcado;
            
            btnEliminar.disabled = !puedeEliminar;
            
            // Cambiar estilo del botÃ³n segÃºn validaciÃ³n
            if (puedeEliminar) {
                btnEliminar.classList.remove('disabled');
                btnEliminar.style.opacity = '1';
            } else {
                btnEliminar.classList.add('disabled');
                btnEliminar.style.opacity = '0.6';
            }
            
            // Validar campo de nombre visualmente
            if (inputNombre.value.trim() === '') {
                inputNombre.classList.remove('is-valid', 'is-invalid');
            } else if (nombreCorrecto) {
                inputNombre.classList.remove('is-invalid');
                inputNombre.classList.add('is-valid');
            } else {
                inputNombre.classList.remove('is-valid');
                inputNombre.classList.add('is-invalid');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            checkboxConfirmar.addEventListener('change', validarFormulario);
            inputNombre.addEventListener('input', validarFormulario);
            
            // ValidaciÃ³n inicial
            validarFormulario();
            
            // Prevenir envÃ­o accidental del formulario
            document.querySelector('.deletion-form').addEventListener('submit', function(e) {
                const nombreCorrecto = inputNombre.value.trim() === nombreServicio;
                const checkboxMarcado = checkboxConfirmar.checked;
                
                if (!nombreCorrecto || !checkboxMarcado) {
                    e.preventDefault();
                    alert('Por favor, completa todos los requisitos de confirmaciÃ³n.');
                    return false;
                }
                
                // Ãšltima confirmaciÃ³n
                const confirmacion = confirm(
                    `Â¿EstÃ¡s ABSOLUTAMENTE SEGURO de que deseas eliminar permanentemente el servicio "${nombreServicio}"?\n\n` +
                    'Esta acciÃ³n NO SE PUEDE DESHACER.\n\n' +
                    'Presiona OK para eliminar o Cancelar para abortar.'
                );
                
                if (!confirmacion) {
                    e.preventDefault();
                    return false;
                }
                
                // Mostrar loading en el botÃ³n
                btnEliminar.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Eliminando...';
                btnEliminar.disabled = true;
            });
        });

        // FunciÃ³n para desactivar en lugar de eliminar
        function desactivarServicio() {
            if (confirm(`Â¿Deseas desactivar el servicio "${nombreServicio}" en lugar de eliminarlo?\n\nPodrÃ¡s reactivarlo mÃ¡s tarde.`)) {
                const form = document.getElementById('desactivarForm');
                form.action = '@Url.Action("CambiarEstado")' + '/@Model.Id' + '?activar=false';
                form.submit();
            }
        }

        // FunciÃ³n para duplicar antes de eliminar
        function duplicarAntes() {
            if (confirm(`Â¿Deseas crear una copia del servicio "${nombreServicio}" antes de eliminarlo?`)) {
                const url = '@Url.Action("Create")' + '?duplicarDesde=@Model.Id';
                window.open(url, '_blank');
            }
        }

        // FunciÃ³n para cancelar eliminaciÃ³n
        function cancelarEliminacion() {
            if (confirm('Â¿EstÃ¡s seguro de que deseas cancelar la eliminaciÃ³n?')) {
                window.location.href = '@Url.Action("Details", new { id = Model.Id })';
            }
        }

        // Efectos visuales de advertencia
        document.addEventListener('DOMContentLoaded', function() {
            // Parpadeo sutil en elementos de advertencia
            setInterval(() => {
                const alertas = document.querySelectorAll('.alert-danger');
                alertas.forEach(alerta => {
                    alerta.style.boxShadow = '0 0 20px rgba(220, 53, 69, 0.3)';
                    setTimeout(() => {
                        alerta.style.boxShadow = '';
                    }, 1000);
                });
            }, 3000);
        });

        // Prevenir salida accidental
        let formSubmitted = false;
        document.querySelector('.deletion-form').addEventListener('submit', function() {
            formSubmitted = true;
        });

        window.addEventListener('beforeunload', function(e) {
            if (!formSubmitted && (checkboxConfirmar.checked || inputNombre.value.trim() !== '')) {
                const mensaje = 'Tienes una eliminaciÃ³n en progreso. Â¿EstÃ¡s seguro de que deseas salir?';
                e.returnValue = mensaje;
                return mensaje;
            }
        });
    </script>
}

<style>
    /* Estilos adicionales para la pÃ¡gina de eliminaciÃ³n */
    .deletion-form {
        position: relative;
    }

    .service-card {
        transition: all 0.3s ease;
    }

    .card {
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-2px);
    }

    .form-check-input:checked {
        background-color: #dc3545;
        border-color: #dc3545;
    }

    .btn-delete:disabled {
        background: #6c757d !important;
        border-color: #6c757d !important;
        cursor: not-allowed;
    }

    .is-valid {
        border-color: #28a745 !important;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
    }

    .is-invalid {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    }

    /* AnimaciÃ³n de advertencia */
    @@keyframes warning-pulse {
        0% { background-color: rgba(220, 53, 69, 0.1); }
        50% { background-color: rgba(220, 53, 69, 0.2); }
        100% { background-color: rgba(220, 53, 69, 0.1); }
    }

    .alert-danger {
        animation: warning-pulse 3s infinite;
    }
</style>
